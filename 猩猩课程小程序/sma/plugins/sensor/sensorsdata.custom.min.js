function _typeof(t) {
    return (_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(t) {
        return typeof t;
    } : function(t) {
        return t && "function" == typeof Symbol && t.constructor === Symbol && t !== Symbol.prototype ? "symbol" : typeof t;
    })(t);
}

var _ = {}, sa = {
    para: {
        name: "sensors",
        server_url: "",
        send_timeout: 1e3,
        use_client_time: !1,
        show_log: !0,
        allow_amend_share_path: !0,
        max_string_length: 300,
        datasend_timeout: 3e3,
        source_channel: [],
        autoTrack: {
            appLaunch: !0,
            appShow: !0,
            appHide: !0,
            pageShow: !0,
            pageShare: !0
        },
        is_persistent_save: !1
    }
}, logger = "object" == _typeof(logger) ? logger : {};

logger.info = function() {
    if (sa.para.show_log && "object" == ("undefined" == typeof console ? "undefined" : _typeof(console)) && console.log) try {
        return console.log.apply(console, arguments);
    } catch (t) {
        console.log(arguments[0]);
    }
}, sa.setPara = function(t) {
    sa.para = _.extend2Lev(sa.para, t);
    var e = [];
    if (_.isArray(sa.para.source_channel)) for (var r = sa.para.source_channel.length, s = 0; s < r; s++) -1 === " utm_source utm_medium utm_campaign utm_content utm_term sa_utm ".indexOf(" " + sa.para.source_channel[s] + " ") && e.push(sa.para.source_channel[s]);
    sa.para.source_channel = e, _.isObject(sa.para.register) && _.extend(_.info.properties, sa.para.register), 
    sa.para.openid_url || (sa.para.openid_url = sa.para.server_url.replace(/([^\/])\/(sa)(\.gif){0,1}/, "$1/mp_login")), 
    "number" != typeof sa.para.send_timeout && (sa.para.send_timeout = 1e3);
    var a = {
        send_timeout: 6e3,
        max_length: 6
    };
    !0 === sa.para.batch_send ? (sa.para.batch_send = _.extend({}, a), sa.para.use_client_time = !0) : "object" == _typeof(sa.para.batch_send) && (sa.para.use_client_time = !0, 
    sa.para.batch_send = _.extend({}, a, sa.para.batch_send)), sa.para.server_url || logger.info("请使用 setPara() 方法设置 server_url 数据接收地址,详情可查看https://www.sensorsdata.cn/manual/mp_sdk_new.html#112-%E5%BC%95%E5%85%A5%E5%B9%B6%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0");
}, sa.status = {};

var ArrayProto = Array.prototype, FuncProto = Function.prototype, ObjProto = Object.prototype, slice = ArrayProto.slice, toString = ObjProto.toString, hasOwnProperty = ObjProto.hasOwnProperty, LIB_VERSION = "1.13.16", LIB_NAME = "MiniProgram", source_channel_standard = "utm_source utm_medium utm_campaign utm_content utm_term", latest_source_channel = [ "$latest_utm_source", "$latest_utm_medium", "$latest_utm_campaign", "$latest_utm_content", "$latest_utm_term", "latest_sa_utm" ], mp_scene = {
    1000: "其他",
    1001: "发现栏小程序主入口，「最近使用」列表（基础库2.2.4版本起包含「我的小程序」列表）",
    1005: "顶部搜索框的搜索结果页",
    1006: "发现栏小程序主入口搜索框的搜索结果页",
    1007: "单人聊天会话中的小程序消息卡片",
    1008: "群聊会话中的小程序消息卡片",
    1011: "扫描二维码",
    1012: "长按图片识别二维码",
    1013: "手机相册选取二维码",
    1014: "小程序模版消息",
    1017: "前往体验版的入口页",
    1019: "微信钱包",
    1020: "公众号 profile 页相关小程序列表",
    1022: "聊天顶部置顶小程序入口",
    1023: "安卓系统桌面图标",
    1024: "小程序 profile 页",
    1025: "扫描一维码",
    1026: "附近小程序列表",
    1027: "顶部搜索框搜索结果页“使用过的小程序”列表",
    1028: "我的卡包",
    1029: "卡券详情页",
    1030: "自动化测试下打开小程序",
    1031: "长按图片识别一维码",
    1032: "手机相册选取一维码",
    1034: "微信支付完成页",
    1035: "公众号自定义菜单",
    1036: "App 分享消息卡片",
    1037: "小程序打开小程序",
    1038: "从另一个小程序返回",
    1039: "摇电视",
    1042: "添加好友搜索框的搜索结果页",
    1043: "公众号模板消息",
    1044: "带 shareTicket 的小程序消息卡片（详情)",
    1045: "朋友圈广告",
    1046: "朋友圈广告详情页",
    1047: "扫描小程序码",
    1048: "长按图片识别小程序码",
    1049: "手机相册选取小程序码",
    1052: "卡券的适用门店列表",
    1053: "搜一搜的结果页",
    1054: "顶部搜索框小程序快捷入口",
    1056: "音乐播放器菜单",
    1057: "钱包中的银行卡详情页",
    1058: "公众号文章",
    1059: "体验版小程序绑定邀请页",
    1064: "微信连Wi-Fi状态栏",
    1067: "公众号文章广告",
    1068: "附近小程序列表广告",
    1069: "移动应用",
    1071: "钱包中的银行卡列表页",
    1072: "二维码收款页面",
    1073: "客服消息列表下发的小程序消息卡片",
    1074: "公众号会话下发的小程序消息卡片",
    1077: "摇周边",
    1078: "连Wi-Fi成功页",
    1079: "微信游戏中心",
    1081: "客服消息下发的文字链",
    1082: "公众号会话下发的文字链",
    1084: "朋友圈广告原生页",
    1088: "会话中查看系统消息，打开小程序",
    1089: "微信聊天主界面下拉",
    1090: "长按小程序右上角菜单唤出最近使用历史",
    1091: "公众号文章商品卡片",
    1092: "城市服务入口",
    1095: "小程序广告组件",
    1096: "聊天记录",
    1097: "微信支付签约页",
    1099: "页面内嵌插件",
    1102: "公众号 profile 页服务预览",
    1103: "发现栏小程序主入口，“我的小程序”列表",
    1104: "微信聊天主界面下拉，“我的小程序”栏",
    1106: "聊天主界面下拉，从顶部搜索结果页，打开小程序",
    1107: "订阅消息，打开小程序",
    1113: "安卓手机负一屏，打开小程序(三星)",
    1114: "安卓手机侧边栏，打开小程序(三星)",
    1124: "扫“一物一码”打开小程序",
    1125: "长按图片识别“一物一码”",
    1126: "扫描手机相册中选取的“一物一码”",
    1129: "微信爬虫访问",
    1131: "浮窗打开小程序",
    1146: "地理位置信息打开出行类小程序",
    1148: "卡包-交通卡，打开小程序"
}, sa_referrer = "直接打开";

sa.status.referrer = "直接打开";

var mpshow_time = null, share_depth = 0, share_distinct_id = "", is_first_launch = !1;

sa.lib_version = LIB_VERSION, function() {
    FuncProto.bind;
    var i = ArrayProto.forEach, s = ArrayProto.indexOf, t = Array.isArray, o = {}, a = _.each = function(t, e, r) {
        if (null == t) return !1;
        if (i && t.forEach === i) t.forEach(e, r); else if (t.length === +t.length) {
            for (var s = 0, a = t.length; s < a; s++) if (s in t && e.call(r, t[s], s, t) === o) return !1;
        } else for (var n in t) if (hasOwnProperty.call(t, n) && e.call(r, t[n], n, t) === o) return !1;
    };
    _.logger = logger, _.extend = function(r) {
        return a(slice.call(arguments, 1), function(t) {
            for (var e in t) void 0 !== t[e] && (r[e] = t[e]);
        }), r;
    }, _.extend2Lev = function(r) {
        return a(slice.call(arguments, 1), function(t) {
            for (var e in t) void 0 !== t[e] && (_.isObject(t[e]) && _.isObject(r[e]) ? _.extend(r[e], t[e]) : r[e] = t[e]);
        }), r;
    }, _.coverExtend = function(r) {
        return a(slice.call(arguments, 1), function(t) {
            for (var e in t) void 0 !== t[e] && void 0 === r[e] && (r[e] = t[e]);
        }), r;
    }, _.isArray = t || function(t) {
        return "[object Array]" === toString.call(t);
    }, _.isFunction = function(t) {
        try {
            return /^\s*\bfunction\b/.test(t);
        } catch (t) {
            return !1;
        }
    }, _.isArguments = function(t) {
        return !(!t || !hasOwnProperty.call(t, "callee"));
    }, _.toArray = function(t) {
        return t ? t.toArray ? t.toArray() : _.isArray(t) || _.isArguments(t) ? slice.call(t) : _.values(t) : [];
    }, _.values = function(t) {
        var e = [];
        return null == t || a(t, function(t) {
            e[e.length] = t;
        }), e;
    }, _.include = function(t, e) {
        var r = !1;
        return null == t ? r : s && t.indexOf === s ? -1 != t.indexOf(e) : (a(t, function(t) {
            if (r = r || t === e) return o;
        }), r);
    };
}(), _.trim = function(t) {
    return t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g, "");
}, _.isObject = function(t) {
    return null != t && "[object Object]" == toString.call(t);
}, _.isEmptyObject = function(t) {
    if (_.isObject(t)) {
        for (var e in t) if (hasOwnProperty.call(t, e)) return !1;
        return !0;
    }
    return !1;
}, _.isUndefined = function(t) {
    return void 0 === t;
}, _.isString = function(t) {
    return "[object String]" == toString.call(t);
}, _.isDate = function(t) {
    return "[object Date]" == toString.call(t);
}, _.isBoolean = function(t) {
    return "[object Boolean]" == toString.call(t);
}, _.isNumber = function(t) {
    return "[object Number]" == toString.call(t) && /[\d\.]+/.test(String(t));
}, _.isJSONString = function(t) {
    try {
        JSON.parse(t);
    } catch (t) {
        return !1;
    }
    return !0;
}, _.decodeURIComponent = function(e) {
    var r = "";
    try {
        r = decodeURIComponent(e);
    } catch (t) {
        r = e;
    }
    return r;
}, _.encodeDates = function(r) {
    return _.each(r, function(t, e) {
        _.isDate(t) ? r[e] = _.formatDate(t) : _.isObject(t) && (r[e] = _.encodeDates(t));
    }), r;
}, _.formatDate = function(t) {
    function e(t) {
        return t < 10 ? "0" + t : t;
    }
    return t.getFullYear() + "-" + e(t.getMonth() + 1) + "-" + e(t.getDate()) + " " + e(t.getHours()) + ":" + e(t.getMinutes()) + ":" + e(t.getSeconds()) + "." + e(t.getMilliseconds());
}, _.searchObjDate = function(r) {
    _.isObject(r) && _.each(r, function(t, e) {
        _.isObject(t) ? _.searchObjDate(r[e]) : _.isDate(t) && (r[e] = _.formatDate(t));
    });
}, _.formatString = function(t) {
    return t.length > sa.para.max_string_length ? (logger.info("字符串长度超过限制，已经做截取--" + t), 
    t.slice(0, sa.para.max_string_length)) : t;
}, _.searchObjString = function(r) {
    _.isObject(r) && _.each(r, function(t, e) {
        _.isObject(t) ? _.searchObjString(r[e]) : _.isString(t) && (r[e] = _.formatString(t));
    });
}, _.unique = function(t) {
    for (var e, r = [], s = {}, a = 0; a < t.length; a++) (e = t[a]) in s || (s[e] = !0, 
    r.push(e));
    return r;
}, _.strip_sa_properties = function(s) {
    return _.isObject(s) && _.each(s, function(e, t) {
        if (_.isArray(e)) {
            var r = [];
            _.each(e, function(t) {
                _.isString(t) ? r.push(t) : logger.info("您的数据-", e, "的数组里的值必须是字符串,已经将其删除");
            }), 0 !== r.length ? s[t] = r : (delete s[t], logger.info("已经删除空的数组"));
        }
        _.isString(e) || _.isNumber(e) || _.isDate(e) || _.isBoolean(e) || _.isArray(e) || (logger.info("您的数据-", e, "-格式不满足要求，我们已经将其删除"), 
        delete s[t]);
    }), s;
}, _.strip_empty_properties = function(t) {
    var r = {};
    return _.each(t, function(t, e) {
        null != t && (r[e] = t);
    }), r;
}, _.utf8Encode = function(t) {
    var e, r, s, a, n = "";
    for (e = r = 0, s = (t = (t + "").replace(/\r\n/g, "\n").replace(/\r/g, "\n")).length, 
    a = 0; a < s; a++) {
        var i = t.charCodeAt(a), o = null;
        i < 128 ? r++ : o = 127 < i && i < 2048 ? String.fromCharCode(i >> 6 | 192, 63 & i | 128) : String.fromCharCode(i >> 12 | 224, i >> 6 & 63 | 128, 63 & i | 128), 
        null !== o && (e < r && (n += t.substring(e, r)), n += o, e = r = a + 1);
    }
    return e < r && (n += t.substring(e, t.length)), n;
}, _.base64Encode = function(t) {
    var e, r, s, a, n, i = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=", o = 0, c = 0, u = "", p = [];
    if (!t) return t;
    for (t = _.utf8Encode(t); e = (n = t.charCodeAt(o++) << 16 | t.charCodeAt(o++) << 8 | t.charCodeAt(o++)) >> 18 & 63, 
    r = n >> 12 & 63, s = n >> 6 & 63, a = 63 & n, p[c++] = i.charAt(e) + i.charAt(r) + i.charAt(s) + i.charAt(a), 
    o < t.length; ) ;
    switch (u = p.join(""), t.length % 3) {
      case 1:
        u = u.slice(0, -2) + "==";
        break;

      case 2:
        u = u.slice(0, -1) + "=";
    }
    return u;
}, _.getCurrentPath = function() {
    var t = "未取到";
    try {
        var e = getCurrentPages();
        t = e[e.length - 1].route;
    } catch (t) {
        logger.info(t);
    }
    return t;
}, _.getCurrentUrl = function(t) {
    var e = _.getCurrentPath(), r = "";
    return _.isObject(t) && t.sensors_mp_encode_url_query && (r = t.sensors_mp_encode_url_query), 
    e ? r ? e + "?" + r : e : "未取到";
}, _.getPath = function(t) {
    return "string" == typeof t ? t.replace(/^\//, "") : "取值异常";
}, sa.initialState = {
    queue: [],
    isComplete: !1,
    systemIsComplete: !1,
    storeIsComplete: !1,
    checkIsComplete: function() {
        this.systemIsComplete && this.storeIsComplete && (this.isComplete = !0, 0 < this.queue.length && (_.each(this.queue, function(t) {
            sa[t[0]].apply(sa, slice.call(t[1]));
        }), this.queue = []));
    }
}, _.getCustomUtmFromQuery = function(t, e, r, s) {
    if (!_.isObject(t)) return {};
    var a = {};
    if (t.sa_utm) for (var n in t) "sa_utm" !== n ? _.include(sa.para.source_channel, n) && (a[r + n] = t[n]) : a[s + n] = t[n]; else for (var n in t) -1 === (" " + source_channel_standard + " ").indexOf(" " + n + " ") ? _.include(sa.para.source_channel, n) && (a[r + n] = t[n]) : a[e + n] = t[n];
    return a;
}, _.getObjFromQuery = function(t) {
    var e = t.split("?"), r = [], s = {};
    return e && e[1] ? (_.each(e[1].split("&"), function(t) {
        (r = t.split("="))[0] && r[1] && (s[r[0]] = r[1]);
    }), s) : {};
}, _.setStorageSync = function(t, e) {
    function r() {
        wx.setStorageSync(t, e);
    }
    try {
        r();
    } catch (t) {
        logger.info("set Storage fail --", t);
        try {
            r();
        } catch (t) {
            logger.info("set Storage fail again --", t);
        }
    }
}, _.getStorageSync = function(e) {
    var r = "";
    try {
        r = wx.getStorageSync(e);
    } catch (t) {
        try {
            r = wx.getStorageSync(e);
        } catch (e) {
            logger.info("getStorage fail");
        }
    }
    return r;
}, _.getMPScene = function(t) {
    return "number" == typeof t || "string" == typeof t && "" !== t ? (t = String(t), 
    mp_scene[t] || t) : "未取到值";
}, _.getShareDepth = function() {
    if ("number" != typeof share_depth || 0 === share_depth) return 1;
    var t = sa.store.getDistinctId(), e = sa.store.getFirstId();
    return !share_distinct_id || share_distinct_id !== t && share_distinct_id !== e ? share_depth + 1 : share_depth;
}, _.setShareInfo = function(t, e) {
    var r = {};
    if (!(t && _.isObject(t.query) && t.query.sampshare)) return {};
    if (r = _.decodeURIComponent(t.query.sampshare), !_.isJSONString(r)) return {};
    var s = (r = JSON.parse(r)).d, a = r.p, n = r.i;
    "string" == typeof n ? (e.$share_distinct_id = n, share_distinct_id = n) : e.$share_distinct_id = "取值异常", 
    "number" == typeof s ? (e.$share_depth = s, share_depth = s) : e.$share_depth = "-1", 
    e.$share_url_path = "string" == typeof a ? a : "取值异常";
}, _.getShareInfo = function() {
    return JSON.stringify({
        i: sa.store.getDistinctId() || "取值异常",
        p: _.getCurrentPath(),
        d: _.getShareDepth()
    });
}, _.detectOptionQuery = function(t) {
    if (!t || !_.isObject(t.query)) return {};
    var e, r, s, a, n = {};
    return n.query = _.extend({}, t.query), "string" == typeof n.query.scene && (e = n.query, 
    r = [ "utm_source", "utm_content", "utm_medium", "utm_campaign", "utm_term", "sa_utm" ].concat(sa.para.source_channel), 
    s = new RegExp("(" + r.join("|") + ")%3D", "i"), 1 === (a = Object.keys(e)).length && "scene" === a[0] && s.test(e.scene)) && (n.scene = n.query.scene, 
    delete n.query.scene), t.query.q && t.query.scancode_time && "101" === String(t.scene).slice(0, 3) && (n.q = String(n.query.q), 
    delete n.query.q, delete n.query.scancode_time), n;
}, _.getMixedQuery = function(t) {
    var e = _.detectOptionQuery(t), r = e.scene, s = e.q, a = e.query;
    for (var n in a) a[n] = _.decodeURIComponent(a[n]);
    return r && (r = -1 !== (r = _.decodeURIComponent(r)).indexOf("?") ? "?" + r.replace(/\?/g, "") : "?" + r, 
    _.extend(a, _.getObjFromQuery(r))), s && _.extend(a, _.getObjFromQuery(_.decodeURIComponent(s))), 
    a;
}, _.setUtm = function(t, e) {
    var r = {}, s = _.getMixedQuery(t), a = _.getCustomUtmFromQuery(s, "$", "_", "$"), n = _.getCustomUtmFromQuery(s, "$latest_", "_latest_", "$latest_");
    return r.pre1 = a, r.pre2 = n, _.extend(e, a), r;
}, _.wxrequest = function(t) {
    var e = wx.request(t);
    setTimeout(function() {
        _.isObject(e) && _.isFunction(e.abort) && e.abort();
    }, sa.para.datasend_timeout);
}, _.info = {
    currentProps: {},
    properties: {
        $lib: LIB_NAME,
        $lib_version: String(LIB_VERSION)
    },
    getSystem: function() {
        var s = this.properties;
        wx.getNetworkType({
            success: function(t) {
                s.$network_type = t.networkType;
            },
            complete: function() {
                wx.getSystemInfo({
                    success: function(t) {
                        var e, r;
                        s.$manufacturer = t.brand, s.$model = t.model, s.$screen_width = Number(t.screenWidth), 
                        s.$screen_height = Number(t.screenHeight), s.$os = "ios" === (r = (e = t.platform).toLowerCase()) ? "iOS" : "android" === r ? "Android" : e, 
                        s.$os_version = -1 < t.system.indexOf(" ") ? t.system.split(" ")[1] : t.system;
                    },
                    complete: function() {
                        sa.initialState.systemIsComplete = !0, sa.initialState.checkIsComplete();
                    }
                });
            }
        });
    }
}, sa._ = _, sa.prepareData = function(t, e) {
    var r = {
        distinct_id: this.store.getDistinctId(),
        lib: {
            $lib: LIB_NAME,
            $lib_method: "code",
            $lib_version: String(LIB_VERSION)
        },
        properties: {}
    };
    _.extend(r, this.store.getUnionId(), t), _.isObject(t.properties) && !_.isEmptyObject(t.properties) && _.extend(r.properties, t.properties), 
    t.type && "profile" === t.type.slice(0, 7) || (sa.para.batch_send && (r._track_id = Number(String(Math.random()).slice(2, 5) + String(Math.random()).slice(2, 4) + String(Date.now()).slice(-4))), 
    r.properties = _.extend({}, _.info.properties, sa.store.getProps(), _.info.currentProps, r.properties), 
    "object" == _typeof(sa.store._state) && "number" == typeof sa.store._state.first_visit_day_time && sa.store._state.first_visit_day_time > new Date().getTime() ? r.properties.$is_first_day = !0 : r.properties.$is_first_day = !1), 
    r.properties.$time && _.isDate(r.properties.$time) ? (r.time = +r.properties.$time, 
    delete r.properties.$time) : sa.para.use_client_time && (r.time = +new Date()), 
    _.searchObjDate(r), _.searchObjString(r), logger.info(r), sa.sendStrategy.send(r);
}, sa.store = {
    verifyDistinctId: function(t) {
        return "number" == typeof t && (t = String(t), /^\d+$/.test(t) || (t = "unexpected_id")), 
        "string" == typeof t && "" !== t || (t = "unexpected_id"), t;
    },
    storageInfo: null,
    getUUID: function() {
        return Date.now() + "-" + Math.floor(1e7 * Math.random()) + "-" + Math.random().toString(16).replace(".", "") + "-" + String(31242 * Math.random()).replace(".", "").slice(0, 8);
    },
    getStorage: function() {
        return this.storageInfo || (this.storageInfo = sa._.getStorageSync("sensorsdata2015_wechat") || ""), 
        this.storageInfo;
    },
    _state: {},
    mem: {
        mdata: [],
        getLength: function() {
            return this.mdata.length;
        },
        add: function(t) {
            this.mdata.push(t);
        },
        clear: function(t) {
            this.mdata.splice(0, t);
        }
    },
    toState: function(t) {
        var e = null;
        _.isJSONString(t) ? (e = JSON.parse(t)).distinct_id ? this._state = e : this.set("distinct_id", this.getUUID()) : _.isObject(t) && (e = t).distinct_id ? this._state = e : this.set("distinct_id", this.getUUID());
    },
    getFirstId: function() {
        return this._state.first_id;
    },
    getDistinctId: function() {
        return this._state.distinct_id;
    },
    getUnionId: function() {
        var t = {};
        return this._state.first_id && this._state.distinct_id ? (t.login_id = this._state.distinct_id, 
        t.anonymous_id = this._state.first_id) : t.anonymous_id = this._state.distinct_id, 
        t;
    },
    getProps: function() {
        return this._state.props || {};
    },
    setProps: function(t, e) {
        var r = this._state.props || {};
        e ? this.set("props", t) : (_.extend(r, t), this.set("props", r));
    },
    set: function(t, e) {
        var r = {};
        for (var s in "string" == typeof t ? r[t] = e : "object" == _typeof(t) && (r = t), 
        this._state = this._state || {}, r) this._state[s] = r[s];
        this.save();
    },
    change: function(t, e) {
        this._state[t] = e;
    },
    save: function() {
        sa._.setStorageSync("sensorsdata2015_wechat", this._state);
    },
    init: function() {
        var t = this.getStorage();
        if (t) this.toState(t); else {
            is_first_launch = !0;
            var e = new Date(), r = e.getTime();
            e.setHours(23), e.setMinutes(59), e.setSeconds(60), sa.setOnceProfile({
                $first_visit_time: new Date()
            }), this.set({
                distinct_id: this.getUUID(),
                first_visit_time: r,
                first_visit_day_time: e.getTime()
            });
        }
    }
}, sa.setProfile = function(t, e) {
    sa.prepareData({
        type: "profile_set",
        properties: t
    }, e);
}, sa.setOnceProfile = function(t, e) {
    sa.prepareData({
        type: "profile_set_once",
        properties: t
    }, e);
}, sa.appendProfile = function(r, t) {
    if (!_.isObject(r)) return !1;
    _.each(r, function(t, e) {
        _.isString(t) ? r[e] = [ t ] : _.isArray(t) || (delete r[e], logger.info("appendProfile属性的值必须是字符串或者数组"));
    }), sa.prepareData({
        type: "profile_append",
        properties: r
    }, t);
}, sa.incrementProfile = function(t, e) {
    if (!_.isObject(t)) return !1;
    var r = t;
    _.isString(t) && ((t = {})[r] = 1), sa.prepareData({
        type: "profile_increment",
        properties: t
    }, e);
}, sa.track = function(t, e, r) {
    this.prepareData({
        type: "track",
        event: t,
        properties: e
    }, r);
}, sa.identify = function(t, e) {
    if ("string" != typeof t && "number" != typeof t) return !1;
    t = sa.store.verifyDistinctId(t);
    var r = sa.store.getFirstId();
    !0 === e ? r ? sa.store.set("first_id", t) : sa.store.set("distinct_id", t) : r ? sa.store.change("first_id", t) : sa.store.change("distinct_id", t);
}, sa.trackSignup = function(t, e, r, s) {
    var a = sa.store.getFirstId() || sa.store.getDistinctId();
    sa.store.set("distinct_id", t), sa.prepareData({
        original_id: a,
        distinct_id: t,
        type: "track_signup",
        event: e,
        properties: r
    }, s);
}, sa.registerApp = function(t) {
    _.isObject(t) && !_.isEmptyObject(t) && (_.info.currentProps = _.extend(_.info.currentProps, t));
}, sa.register = function(t) {
    _.isObject(t) && !_.isEmptyObject(t) && sa.store.setProps(t);
}, sa.clearAllRegister = function() {
    sa.store.setProps({}, !0);
}, sa.clearAllProps = function(r) {
    var t = sa.store.getProps(), s = {};
    _.isArray(r) && (_.each(t, function(t, e) {
        _.include(r, e) || (s[e] = t);
    }), sa.store.setProps(s, !0));
}, sa.clearAppRegister = function(r) {
    _.isArray(r) && _.each(_.info.currentProps, function(t, e) {
        _.include(r, e) && delete _.info.currentProps[e];
    });
}, sa.setLatestChannel = function(t) {
    _.isEmptyObject(t) || (function(t, e) {
        var r = !1;
        for (var s in e) t[e[s]] && (r = !0);
        return r;
    }(t, latest_source_channel) && (sa.clearAppRegister(latest_source_channel), sa.clearAllProps(latest_source_channel)), 
    sa.para.is_persistent_save ? sa.register(t) : sa.registerApp(t));
}, sa.login = function(t) {
    if ("string" != typeof t && "number" != typeof t) return !1;
    t = sa.store.verifyDistinctId(t);
    var e = sa.store.getFirstId(), r = sa.store.getDistinctId();
    t !== r && (e || sa.store.set("first_id", r), sa.trackSignup(t, "$SignUp"));
}, sa.openid = {
    getRequest: function(e) {
        wx.login({
            success: function(t) {
                t.code && sa.para.appid && sa.para.openid_url ? _.wxrequest({
                    url: sa.para.openid_url + "&code=" + t.code + "&appid=" + sa.para.appid,
                    method: "GET",
                    complete: function(t) {
                        _.isObject(t) && _.isObject(t.data) && t.data.openid ? e(t.data.openid) : e();
                    }
                }) : e();
            }
        });
    },
    getWXStorage: function() {
        var t = sa.store.getStorage();
        if (t && _.isObject(t)) return t.openid;
    },
    getOpenid: function(t) {
        if (!sa.para.appid) return t(), !1;
        var e = this.getWXStorage();
        e ? t(e) : this.getRequest(t);
    }
}, sa.initial = function() {
    this._.info.getSystem(), this.store.init();
}, sa.init = function(t) {
    if (!0 === this.hasInit) return !1;
    this.hasInit = !0, sa.setPara(t), sa.para.batch_send && (wx.getStorage({
        key: "sensors_mp_prepare_data",
        complete: function(t) {
            var e = t.data && _.isArray(t.data) ? t.data : [];
            sa.store.mem.mdata = e.concat(sa.store.mem.mdata), sa.sendStrategy.syncStorage = !0;
        }
    }), sa.sendStrategy.batchInterval()), sa.initialState.storeIsComplete = !0, sa.initialState.checkIsComplete();
}, sa.getPresetProperties = function() {
    if (_.info && _.info.properties && _.info.properties.$lib) {
        var r = {};
        _.each(_.info.currentProps, function(t, e) {
            0 === e.indexOf("$") && (r[e] = t);
        });
        var t = _.extend(r, {
            $url_path: _.getCurrentPath()
        }, _.info.properties, sa.store.getProps());
        return delete t.$lib, t;
    }
    return {};
}, _.autoExeQueue = function() {
    return {
        items: [],
        enqueue: function(t) {
            this.items.push(t), this.start();
        },
        dequeue: function() {
            return this.items.shift();
        },
        getCurrentItem: function() {
            return this.items[0];
        },
        isRun: !1,
        start: function() {
            0 < this.items.length && !this.isRun && (this.isRun = !0, this.getCurrentItem().start());
        },
        close: function() {
            this.dequeue(), this.isRun = !1, this.start();
        }
    };
}, sa.requestQueue = function(t) {
    this.url = t.url;
}, sa.requestQueue.prototype.isEnd = function() {
    this.received || (this.received = !0, this.close());
}, sa.requestQueue.prototype.start = function() {
    var t = this;
    setTimeout(function() {
        t.isEnd();
    }, sa.para.send_timeout), _.wxrequest({
        url: this.url,
        method: "GET",
        complete: function() {
            t.isEnd();
        }
    });
}, sa.dataQueue = _.autoExeQueue(), sa.sendStrategy = {
    dataHasSend: !0,
    dataHasChange: !1,
    syncStorage: !1,
    onAppHide: function() {
        sa.para.batch_send && this.batchSend();
    },
    send: function(t) {
        if (!sa.para.server_url) return !1;
        if (sa.para.batch_send) {
            if (this.dataHasChange = !0, 300 <= sa.store.mem.getLength()) return logger.info("数据量存储过大，有异常"), 
            !1;
            sa.store.mem.add(t), sa.store.mem.getLength() >= sa.para.batch_send.max_length && this.batchSend();
        } else this.queueSend(t);
    },
    queueSend: function(t) {
        t = JSON.stringify(t), t = -1 !== sa.para.server_url.indexOf("?") ? sa.para.server_url + "&data=" + encodeURIComponent(_.base64Encode(t)) : sa.para.server_url + "?data=" + encodeURIComponent(_.base64Encode(t));
        var e = new sa.requestQueue({
            url: t
        });
        e.close = function() {
            sa.dataQueue.close();
        }, sa.dataQueue.enqueue(e);
    },
    wxrequest: function(t) {
        if (_.isArray(t.data) && 0 < t.data.length) {
            var e = Date.now();
            t.data.forEach(function(t) {
                t._flush_time = e;
            }), t.data = JSON.stringify(t.data), _.wxrequest({
                url: sa.para.server_url,
                method: "POST",
                dataType: "text",
                data: "data_list=" + encodeURIComponent(_.base64Encode(t.data)),
                success: function() {
                    t.success(t.len);
                },
                fail: function() {
                    t.fail();
                }
            });
        } else t.success(t.len);
    },
    batchSend: function() {
        if (this.dataHasSend) {
            var t = sa.store.mem.mdata, e = t.length;
            0 < e && (this.dataHasSend = !1, this.wxrequest({
                data: t,
                len: e,
                success: this.batchRemove.bind(this),
                fail: this.sendFail.bind(this)
            }));
        }
    },
    sendFail: function() {
        this.dataHasSend = !0;
    },
    batchRemove: function(t) {
        sa.store.mem.clear(t), this.dataHasSend = !0, this.dataHasChange = !0, this.batchWrite();
    },
    is_first_batch_write: !0,
    batchWrite: function() {
        var t = this;
        this.dataHasChange && (this.is_first_batch_write && (this.is_first_batch_write = !1, 
        setTimeout(function() {
            t.batchSend();
        }, 1e3)), this.dataHasChange = !1, this.syncStorage && sa._.setStorageSync("sensors_mp_prepare_data", sa.store.mem.mdata));
    },
    batchInterval: function() {
        var e = this;
        !function t() {
            setTimeout(function() {
                e.batchWrite(), t();
            }, 500);
        }(), function t() {
            setTimeout(function() {
                e.batchSend(), t();
            }, sa.para.batch_send.send_timeout);
        }();
    }
}, sa.setOpenid = function(t, e) {
    sa.store.set("openid", t), e ? sa.store.set("distinct_id", t) : sa.identify(t, !0);
}, sa.initWithOpenid = function(e, r) {
    (e = e || {}).appid && (sa.para.appid = e.appid), sa.openid.getOpenid(function(t) {
        t && sa.setOpenid(t, e.isCoverLogin), r && _.isFunction(r) && r(t), sa.init(e);
    });
}, _.each([ "setProfile", "setOnceProfile", "track", "quick", "incrementProfile", "appendProfile" ], function(t) {
    var e = sa[t];
    sa[t] = function() {
        sa.initialState.isComplete ? e.apply(sa, arguments) : sa.initialState.queue.push([ t, arguments ]);
    };
}), _.setQuery = function(t, r) {
    if (t && _.isObject(t) && !_.isEmptyObject(t)) {
        var s = [];
        return _.each(t, function(t, e) {
            "q" === e && _.isString(t) && 0 === t.indexOf("http") || "scene" === e || (r ? s.push(e + "=" + t) : s.push(e + "=" + _.decodeURIComponent(t)));
        }), s.join("&");
    }
    return "";
}, _.getUtmFromPage = function() {
    var t = {};
    try {
        var e = getCurrentPages(), r = e[e.length - 1].options;
        t = _.getCustomUtmFromQuery(r, "$", "_", "$");
    } catch (t) {
        logger.info(t);
    }
    return t;
}, sa.autoTrackCustom = {
    trackCustom: function(t, e, r) {
        var s = sa.para.autoTrack[t], a = "";
        sa.para.autoTrack && s && ("function" == typeof s ? (a = s(), _.isObject(a) && _.extend(e, a)) : _.isObject(s) && (_.extend(e, s), 
        sa.para.autoTrack[t] = !0), sa.track(r, e));
    },
    appLaunch: function(t, e) {
        "object" != _typeof(this) || this.trackCustom || (this[sa.para.name] = sa);
        var r = {};
        t && t.path && (r.$url_path = _.getPath(t.path)), _.setShareInfo(t, r);
        var s = _.setUtm(t, r);
        is_first_launch ? (r.$is_first_time = !0, _.isEmptyObject(s.pre1) || sa.setOnceProfile(s.pre1)) : r.$is_first_time = !1, 
        sa.setLatestChannel(s.pre2), r.$scene = _.getMPScene(t.scene), sa.registerApp({
            $latest_scene: r.$scene
        }), r.$url_query = _.setQuery(t.query), e ? (r = _.extend(r, e), sa.track("$MPLaunch", r)) : sa.para.autoTrack && sa.para.autoTrack.appLaunch && sa.autoTrackCustom.trackCustom("appLaunch", r, "$MPLaunch");
    },
    appShow: function(t, e) {
        var r = {};
        mpshow_time = new Date().getTime(), t && t.path && (r.$url_path = _.getPath(t.path)), 
        _.setShareInfo(t, r);
        var s = _.setUtm(t, r);
        sa.setLatestChannel(s.pre2), r.$scene = _.getMPScene(t.scene), sa.registerApp({
            $latest_scene: r.$scene
        }), r.$url_query = _.setQuery(t.query), e ? (r = _.extend(r, e), sa.track("$MPShow", r)) : sa.para.autoTrack && sa.para.autoTrack.appShow && sa.autoTrackCustom.trackCustom("appShow", r, "$MPShow");
    },
    appHide: function(t) {
        var e = new Date().getTime(), r = {};
        r.$url_path = _.getCurrentPath(), mpshow_time && 0 < e - mpshow_time && (e - mpshow_time) / 36e5 < 24 && (r.event_duration = (e - mpshow_time) / 1e3), 
        t ? (r = _.extend(r, t), sa.track("$MPHide", r)) : sa.para.autoTrack && sa.para.autoTrack.appHide && sa.autoTrackCustom.trackCustom("appHide", r, "$MPHide"), 
        sa.sendStrategy.onAppHide();
    }
}, sa.quick = function() {
    var t = arguments[0], e = arguments[1], r = arguments[2], s = _.isObject(r) ? r : {};
    if ("getAnonymousID" === t) {
        if (!_.isEmptyObject(sa.store._state)) return sa.store._state.first_id ? sa.store._state.first_id : sa.store._state.distinct_id;
        logger.info("请先初始化SDK");
    } else "appLaunch" === t || "appShow" === t ? e ? sa.autoTrackCustom[t](e, s) : logger.info("App的launch和show，在sensors.quick第二个参数必须传入App的options参数") : "appHide" === t && (s = _.isObject(e) ? e : {}, 
    sa.autoTrackCustom[t](s));
}, sa.initial(), module.exports = sa;